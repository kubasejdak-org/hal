pages:
  stage: deploy
  rules:
    - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH && $CI_PIPELINE_SOURCE != "pipeline"
  image: ${DOCKER_IMAGE_GCC}
  tags:
    - cet_build
  needs:
    - Coverage_Total
  artifacts:
    paths:
      - public
  script:
    # Copy coverage report.
    - mkdir -p public/coverage
    - mv Coverage_Total/html/* public/coverage

    # Generate documentation.
    - mkdir -p public/docs
    - mkdir ${CI_JOB_NAME}
    - cd ${CI_JOB_NAME}

    - cmake .. -DAPP=middleware
    - make doxygen
    - mv docs/* ../public/docs
